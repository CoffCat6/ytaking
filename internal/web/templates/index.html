{{define "content"}}
<!-- 精选文章 - 顶部大图布局 -->
{{if .FeaturedPosts}}
<section class="featured-hero">
  <div class="featured-carousel" id="featured-carousel" data-rotate="true">
    {{range $i, $post := .FeaturedPosts}}
    <article class="featured-item {{if eq $i 0}}is-active{{end}}">
      <a href="{{$.SiteURL}}/posts/{{$post.Slug}}" class="featured-image">
        {{if $post.CoverImage}}
        <img src="{{assetURL $post.CoverImage}}" alt="{{$post.Title}}">
        {{else}}
        <div class="featured-placeholder">
          <span>精选</span>
        </div>
        {{end}}
      </a>
      <div class="featured-content">
        <div class="featured-label">
          <span class="label-text">精选文章</span>
          {{if gt (len $.FeaturedPosts) 1}}
          <span class="label-count">{{add $i 1}} / {{len $.FeaturedPosts}}</span>
          {{end}}
        </div>
        <h2 class="featured-title">
          <a href="{{$.SiteURL}}/posts/{{$post.Slug}}">{{$post.Title}}</a>
        </h2>
        <p class="featured-summary">{{$post.Summary}}</p>
        <div class="featured-meta">
          <span class="meta-date">{{formatDate $post.CreatedAt}}</span>
          {{if $post.Category}}<span class="meta-category">{{$post.Category}}</span>{{end}}
        </div>
        {{if $post.Tags}}
        <div class="featured-tags">
          {{range $post.Tags}}<span class="tag">{{.}}</span>{{end}}
        </div>
        {{end}}
        <a class="featured-link" href="{{$.SiteURL}}/posts/{{$post.Slug}}">
          阅读全文
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </a>
      </div>
    </article>
    {{end}}
  </div>
  {{if gt (len .FeaturedPosts) 1}}
  <div class="featured-nav">
    <button class="featured-nav-btn" id="featured-prev" aria-label="上一篇">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>
    <button class="featured-nav-btn" id="featured-next" aria-label="下一篇">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 18l6-6-6-6"/>
      </svg>
    </button>
  </div>
  {{end}}
</section>
{{end}}

<!-- 关于我区块 -->
<section id="about" class="section about about-vertical">
  <!-- 头像和基本信息 -->
  <div class="about-header">
    <div class="about-avatar">
      {{if .Avatar}}
      <img src="{{assetURL .Avatar}}" alt="{{.Title}}"
        data-avatar-pos-x="{{printf "%.0f" .AvatarPosX}}"
        data-avatar-pos-y="{{printf "%.0f" .AvatarPosY}}"
        data-avatar-scale="{{printf "%.2f" .AvatarScale}}"
        style="object-position: 50% 50%; transform: scale(1);">
      {{else}}
      <div class="avatar-placeholder">上传头像</div>
      {{end}}
    </div>
    <div class="about-info">
      <h2>关于我</h2>
      <p class="about-position">{{if .Positioning}}{{.Positioning}}{{else}}{{.Intro}}{{end}}</p>
      <div class="about-tags">
        {{range .Skills}}
        <span>{{.}}</span>
        {{end}}
      </div>
      <div class="about-links">
        {{if .Email}}
        <a class="social-pill" href="mailto:{{.Email}}">
          <span class="social-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" role="img" focusable="false">
              <path d="M4 6.5h16a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2zm0 2.2v6.8h16V8.7l-8 5.1-8-5.1zm8 3.4 8-5.1H4l8 5.1z"></path>
            </svg>
          </span>
          邮箱
        </a>
        {{end}}
        {{range .SocialLinks}}
        <a class="social-pill" href="{{.URL}}" target="_blank" rel="noopener">
          <span class="social-icon" aria-hidden="true">
            {{if eq .Name "GitHub"}}
            <svg viewBox="0 0 24 24" role="img" focusable="false">
              <path d="M12 2C6.48 2 2 6.58 2 12.26c0 4.55 2.87 8.4 6.84 9.76.5.09.68-.22.68-.49 0-.24-.01-.87-.01-1.71-2.78.62-3.37-1.37-3.37-1.37-.45-1.18-1.11-1.5-1.11-1.5-.91-.64.07-.63.07-.63 1 .07 1.53 1.05 1.53 1.05.9 1.56 2.36 1.11 2.94.85.09-.67.35-1.11.64-1.37-2.22-.26-4.56-1.14-4.56-5.06 0-1.12.39-2.03 1.03-2.75-.1-.26-.45-1.32.1-2.75 0 0 .84-.27 2.75 1.05A9.3 9.3 0 0 1 12 6.8c.85 0 1.7.12 2.5.36 1.9-1.32 2.74-1.05 2.74-1.05.55 1.43.2 2.49.1 2.75.64.72 1.03 1.63 1.03 2.75 0 3.93-2.34 4.79-4.57 5.05.36.32.68.95.68 1.92 0 1.38-.01 2.5-.01 2.84 0 .27.18.59.69.49A10.03 10.03 0 0 0 22 12.26C22 6.58 17.52 2 12 2z"></path>
            </svg>
            {{else}}
            <svg viewBox="0 0 24 24" role="img" focusable="false">
              <path d="M14 3h7v7h-2V6.41l-9.3 9.3-1.4-1.42 9.3-9.3H14V3zM5 5h6v2H7v10h10v-4h2v6H5V5z"></path>
            </svg>
            {{end}}
          </span>
          {{.Name}}
        </a>
        {{end}}
      </div>
    </div>
  </div>
  
  <!-- 个人简历/详细介绍 -->
  <div class="about-body">
    {{if .HeroBioHTML}}
    <div class="about-bio">
      <div class="hero-bio" id="hero-bio">{{.HeroBioHTML}}</div>
      <button class="hero-bio-toggle" id="hero-bio-toggle" type="button">展开更多</button>
    </div>
    {{end}}
  </div>
</section>

<section id="posts" class="section">
  <div class="section-head">
    <h2>最新文章</h2>
    <p>每周更新一到两篇，关注产品、工程与写作。</p>
  </div>
  <div class="filter-bar">
    <div class="filter-group">
      <label for="filter-category">分类</label>
      <select id="filter-category">
        <option value="">全部</option>
        {{range .CategoryFilters}}
        <option value="{{.}}">{{.}}</option>
        {{end}}
      </select>
    </div>
    <div class="filter-group">
      <label for="filter-tag">标签</label>
      <select id="filter-tag">
        <option value="">全部</option>
        {{range .TagFilters}}
        <option value="{{.}}">{{.}}</option>
        {{end}}
      </select>
    </div>
  </div>
  <div class="post-grid fixed-grid">
    {{range .Posts}}
    <article class="post-card" data-category="{{.Category}}"
      data-tags="{{range $i, $t := .Tags}}{{if $i}},{{end}}{{lower $t}}{{end}}">
      <div class="post-thumb">
        {{if .CoverImage}}
        <img src="{{assetURL .CoverImage}}" alt="{{.Title}}">
        {{else}}
        <span>图片占位</span>
        {{end}}
      </div>
      <div class="post-meta">
        <span>{{formatDate .CreatedAt}}</span>
        {{if .Category}}<span class="badge" data-category="{{.Category}}">{{.Category}}</span>{{end}}
        {{if .Featured}}<span class="badge cat-featured">精选</span>{{end}}
      </div>
      {{if .Tags}}
      <div class="tag-row">
        {{range .Tags}}<span class="tag">{{.}}</span>{{end}}
      </div>
      {{end}}
      <h3>{{.Title}}</h3>
      <p>{{.Summary}}</p>
      <a class="text-link stretched-link" href="{{$.SiteURL}}/posts/{{.Slug}}">继续阅读 -></a>
    </article>
    {{end}}
  </div>
  <div class="pagination">
    {{if .HasPrev}}
    <a class="pagination-link" href="{{.PrevURL}}">← 上一页</a>
    {{else}}
    <span class="pagination-disabled">← 上一页</span>
    {{end}}
    <span class="pagination-info">第 {{.CurrentPage}} / {{.TotalPages}} 页</span>
    {{if .HasNext}}
    <a class="pagination-link" href="{{.NextURL}}">下一页 →</a>
    {{else}}
    <span class="pagination-disabled">下一页 →</span>
    {{end}}
  </div>
</section>




<script>
  (function () {
    var avatar = document.querySelector(".about-avatar img");
    if (!avatar) return;
    var posX = avatar.getAttribute("data-avatar-pos-x");
    var posY = avatar.getAttribute("data-avatar-pos-y");
    var scale = avatar.getAttribute("data-avatar-scale");
    if (posX !== null && posY !== null) {
      avatar.style.objectPosition = posX + "% " + posY + "%";
    }
    if (scale !== null) {
      avatar.style.transform = "scale(" + scale + ")";
    }
  })();
  // Hero Bio 展开/收起功能
  (function () {
    var bio = document.getElementById("hero-bio");
    var toggle = document.getElementById("hero-bio-toggle");
    if (!bio || !toggle) return;
    
    var maxHeight = 280; // 与 CSS 中的 max-height 保持一致
    var isExpanded = false;
    
    function checkHeight() {
      // 获取实际内容高度
      var contentHeight = bio.scrollHeight;
      if (contentHeight > maxHeight) {
        // 内容超出，显示折叠状态和按钮
        bio.classList.add("is-collapsed");
        toggle.classList.add("is-visible");
      } else {
        // 内容未超出，隐藏按钮
        bio.classList.remove("is-collapsed");
        toggle.classList.remove("is-visible");
      }
    }
    
    toggle.addEventListener("click", function () {
      isExpanded = !isExpanded;
      if (isExpanded) {
        bio.classList.remove("is-collapsed");
        toggle.textContent = "收起";
      } else {
        bio.classList.add("is-collapsed");
        toggle.textContent = "展开更多";
        // 滚动到 hero 区域顶部
        bio.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    });
    
    // 初始化检查
    checkHeight();
    // 窗口大小变化时重新检查
    window.addEventListener("resize", checkHeight);
  })();
  // 精选文章轮播
  (function () {
    var carousel = document.getElementById("featured-carousel");
    if (!carousel) return;
    
    var slides = carousel.querySelectorAll(".featured-item");
    var prevBtn = document.getElementById("featured-prev");
    var nextBtn = document.getElementById("featured-next");
    
    if (slides.length <= 1) return;
    
    var index = 0;
    var autoplayTimer = null;
    var autoplayDelay = 6000;
    
    function showSlide(newIndex) {
      slides[index].classList.remove("is-active");
      index = (newIndex + slides.length) % slides.length;
      slides[index].classList.add("is-active");
    }
    
    function nextSlide() {
      showSlide(index + 1);
    }
    
    function prevSlide() {
      showSlide(index - 1);
    }
    
    function startAutoplay() {
      stopAutoplay();
      autoplayTimer = setInterval(nextSlide, autoplayDelay);
    }
    
    function stopAutoplay() {
      if (autoplayTimer) {
        clearInterval(autoplayTimer);
        autoplayTimer = null;
      }
    }
    
    if (prevBtn) {
      prevBtn.addEventListener("click", function () {
        prevSlide();
        startAutoplay(); // 重置自动播放
      });
    }
    
    if (nextBtn) {
      nextBtn.addEventListener("click", function () {
        nextSlide();
        startAutoplay(); // 重置自动播放
      });
    }
    
    // 鼠标悬停时暂停
    carousel.addEventListener("mouseenter", stopAutoplay);
    carousel.addEventListener("mouseleave", startAutoplay);
    
    // 启动自动播放
    startAutoplay();
  })();
  (function () {
    var categorySelect = document.getElementById("filter-category");
    var tagSelect = document.getElementById("filter-tag");
    var cards = document.querySelectorAll(".post-card");
    if (!categorySelect || !tagSelect || cards.length === 0) return;
    function applyFilter() {
      var category = categorySelect.value;
      var tag = tagSelect.value.toLowerCase();
      cards.forEach(function (card) {
        var cardCategory = card.getAttribute("data-category") || "";
        var cardTags = (card.getAttribute("data-tags") || "").split(",");
        var matchCategory = category === "" || cardCategory === category;
        var matchTag = tag === "" || cardTags.indexOf(tag) >= 0;
        card.style.display = matchCategory && matchTag ? "flex" : "none";
      });
    }
    categorySelect.addEventListener("change", applyFilter);
    tagSelect.addEventListener("change", applyFilter);
  })();
</script>
{{end}}
